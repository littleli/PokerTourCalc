<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="jquery.mobile.min.css">
    <script src="cordova-2.0.0.js"></script>
    <script src="jquery.min.js"></script>
    <script src="jquery.mobile.min.js"></script>
    <script src="jsrender.js"></script>
</head>

<body>

<section data-role="page">

    <header data-role="header" id="welcome">
        <h1>PokerTour Points</h1>
    </header>

    <section data-role="content">
        <img src="images/poker-icon.png" alt="logo">
        <br>
        <a href="#calculator" data-role="button" data-transition="flow" data-icon="star" data-theme="a">Tap to begin</a>
    </section>

</section>

<section data-role="page" id="calculator">

    <header data-role="header">
        <h1>Calculate please</h1>
    </header>

    <section data-role="content">
        <label for="buyin" class="ui-hidden-accessible">Buy in</label>
        <input type="number" id="buyin" name="buyin" value="300" min="300" placeholder="Buy in">

        <label for="players" class="ui-hidden-accessible">Number of players</label>
        <input type="number" id="players" name="players" value="7" min="3" placeholder="# of players">

        <label for="position" class="ui-hidden-accessible">Final position</label>
        <input type="number" id="position" name="position" placeholder="Final position">

        <div id="score">
            &nbsp;
        </div>

        <a href="#" id="count_score" data-role="button" data-theme="b">Count</a>
        <a href="#scoreboard" id="to_scoreboard" data-transition="flow"
           data-role="button" data-theme="a">
            Score board
        </a>
    </section>

</section>

<section data-role="page" id="scoreboard">

    <header data-role="header">
        <h1>Poker Tour Calculator</h1>
    </header>

    <section data-role="content">
        <ul id="ranks" data-role="listview" data-inset="false" data-filter="true">
        </ul>
    </section>

</section>

<script id="scoreboardEntry" type="text/x-jsrender">
    <li>{{>rank}}.<span class="ui-li-count ui-btn-down-e ui-btn-corner-all">{{>points}}</span></li>
</script>

<script>
    function scoreboard(buyin, players, final) {
        var countPointsForPosition = function(pos) {
            var multiplePoints = buyin < 1000 ? 10 : 20;
            return Math.ceil(multiplePoints * Math.sqrt((Math.sqrt(buyin) * (players - 6) / pos)));
        }
        var numberOfRanks = Math.ceil(players * 0.2);
        var ranks = [];
        for (var i = 0; i < numberOfRanks; i++) {
            ranks[i] = { rank: i + 1, points: countPointsForPosition(i + 1) };
        }
        return ranks;
    }

    $.templates({
        scoreEntry:"#scoreboardEntry"
    });

    $("#to_scoreboard").on("tap", function(e) {
        $("#ranks").html(
                $.render.scoreEntry(scoreboard(
                        $("#buyin").val(), $("#players").val(), $("#position").val()
                ))
        ).listview('refresh');
    });
</script>
</body>

</html>